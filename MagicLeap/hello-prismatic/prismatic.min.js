/*
 @license
 Copyright (c) 2019 Magic Leap, Inc. All Rights Reserved.
 You may use this file to develop and test websites that are compatible with
 Magic Leap's mixed reality technology platform (including Magic Leap's mixed
 reality hardware device(s) manufactured by or on behalf of Magic Leap and
 Magic Leap's operating systems), and distribute this file as incorporated
 into those websites.  You may not modify this file, or use this file to
 directly or indirectly develop websites that are incompatible Magic Leap's
 mixed reality technology platform.

 TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, MAGIC LEAP IS PROVIDING
 THIS FILE ON AN "AS-IS" BASIS FOR USE AT YOUR OWN RISK. MAGIC LEAP DISCLAIMS
 ALL WARRANTIES WITH RESPECT TO THIS FILE, WHETHER EXPRESS OR IMPLIED, OR
 STATUTORY, INCLUDING, WITHOUT LIMITATION, ANY WARRANTIES OF NON-INFRINGEMENT
 OF THIRD-PARTY RIGHTS, MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE,
 QUIET ENJOYMENT, NON-INTERFERENCE, SYSTEM INTEGRATION, OR ACCURACY.
 MAGIC LEAP DOES NOT WARRANT THAT YOUR USE OF THIS FILE WILL BE UNINTERRUPTED
 ERROR-FREE, VIRUS-FREE, OR SECURE.
*/
'use strict';(function(m,t){"object"===typeof exports&&"undefined"!==typeof module?t(exports):"function"===typeof define&&define.amd?define(["exports"],t):t(m.prismatic={})})(this,function(m){function t(){n(this,!0)}function Aa(){Q(this)}let R=()=>{window.mlWorld.update()},h=(a)=>{let b=window.mlWorld.browserWidth-.1,c=window.innerWidth;a=parseFloat(a)/c;return Math.fround(a*b)},p=(a)=>({width:h(a.clientWidth),height:h(a.clientHeight),breadth:a.breadth?h(a.breadth):h(Math.max(a.clientWidth,a.clientHeight))}),
G=(a)=>{var b=a.getBoundingClientRect();let c=S(b.left+a.clientWidth/2);b=T(b.top+a.clientHeight/2);a=U(a.zOffset);return{positionX:c,positionY:b,positionZ:a}},S=(a)=>{a=h(a)+.05-window.mlWorld.browserWidth/2;return Math.fround(a)},T=(a)=>{a=window.mlWorld.browserHeight/2-(h(a)+.096);return Math.fround(a)},U=(a)=>{a=h(a);return Math.fround(a)},v=(a)=>{let {positionX:b,positionY:c,positionZ:d}=G(a),{width:e,height:f,breadth:g}=p(a);return Math.abs(b)>mlWorld.browserWidth/2||Math.abs(c)>mlWorld.browserHeight/
2||Math.abs(d)>Math.max(mlWorld.browserWidth,mlWorld.browserHeight)/2||e>mlWorld.browserWidth||f>mlWorld.browserHeight||g>Math.max(mlWorld.browserWidth,mlWorld.browserHeight)?!0:!1},w=(a,b)=>{console.warn(b);a.style.border="solid 2px #ffffff47";a.style.color="#FFF";a.style.color="#FFF";a.style.textTransform="uppercase";a.style.letterSpacing="2px";a.style.fontSize="14px";a.style.padding="2%";a.innerHTML="MR Content"},x=(a)=>{var b=0;parseFloat(a)&&(b=a.toString().replace(/[^A-Za-z]/g,"").toLowerCase(),
b="cm"===b?parseFloat(a)/.026458333:"mm"===b?parseFloat(a)/.026458333/10:parseFloat(a));return b},k=(a)=>{if(!a)return!1;var b=window.getComputedStyle(a,"");return"none"==b.display||"hidden"==b.visibility||a.hidden?!1:!0},Ba=(a)=>{var b={};a.split(/;/).forEach((a)=>{a=a.split(":");2===a.length&&("textures"===a[0].trim()?b[a[0].trim()]=a[1].trim().replace(/\r?\n|\r|\t|,/gm," ").replace(/  +/g," ").split(/ /).filter((a)=>a.trim()):b[a[0].trim()]=a[1].trim())});if(b.kmat&&b.textures&&0<b.textures.length)return b;
console.error("Invalid values used for materials attribute. No materials loaded.")},Ca=(a,b)=>Promise.all(b.map(function(b){return new Promise((c,e)=>{var d=new Image;d.onload=()=>{c(a.createTexture(d,b))};d.onerror=()=>{e(Error(`Problem loading texture ${b}.`))};d.src=b})})),Da=(a,b)=>fetch(b).then((c)=>c.ok?c.arrayBuffer().then((c)=>a.createKMat(c,b)):Promise.reject(Error(`Problem creating KMat file: ${b}`))),H=(a)=>{let b=a.trim().replace(/[^\d.-]+/g," ").split(" ").map(parseFloat).filter((a)=>
!isNaN(a));var c=b.reduce((a,b)=>a+(0===b),0);a.split("deg").length-1>=3-c&&(b=b.map((a)=>Math.PI/180*a));if(b&&3===b.length)return b;console.error("Invalid values used for rotation attribute.")},n=(a,b=!1)=>{if(a._volume){let {positionX:c,positionY:d,positionZ:e}=G(a);a._volume.position={positionX:c,positionY:d,positionZ:e};let f=(new DOMMatrix).translate(c,d,e);a.prismRotation&&b&&(b=H(a.prismRotation))&&(f=f.rotateAxisAngle(0,0,1,180/Math.PI*b[2]).rotateAxisAngle(0,1,0,180/Math.PI*b[1]).rotateAxisAngle(1,
0,0,180/Math.PI*b[0]));a._volume.transformVolumeRelativeToHostVolume(f)}},l=(a)=>{delete a._originalPosition;delete a._originalVolumeSize;delete a._originalScale},I=(a)=>{if(a._model){let {width:d,height:e,breadth:f}=p(a);if(!a.hasAttribute("fill")||""!==a.getAttribute("fill")&&"true"!==a.getAttribute("fill")){if(a.breadth)b=Math.min(d/a._resource.width,e/a._resource.height,f/a._resource.depth);else{var b=Math.min(d/a._resource.width,e/a._resource.height),c=Math.fround(a._resource.depth*b);a._volume.breadth<
1.001*c&&!(Math.abs(a._volume.breadth-1.001*c)<Number.EPSILON)&&a._volume.setSize(1.001*d,1.001*e,1.001*c)}a._model.setLocalScale(new Float32Array([b,b,b]))}else a._model.setLocalScale(new Float32Array([d/a._resource.width,e/a._resource.height,f/a._resource.depth]));a._model.setAnchorPosition(new Float32Array([a._resource.center.x,a._resource.center.y,a._resource.center.z]));l(a)}},J=(a)=>{if(a._quad){let {width:b,height:c}=p(a);a._quad.setLocalScale(new Float32Array([b,c,0]));a._quad.setLocalPosition(new Float32Array([-(b/
2),-(c/2),0]))}},Q=(a)=>{if(a._model||a._quad)!a.scrollable&&v(a)?navigator.permissions.request({name:"ml-unbounded-prisms"}).then((b)=>{"granted"==b.state?V(a):"denied"==b.state&&console.error("Permission to render unbounded volume has not been granted")}).catch((b)=>{w(a,"Requesting ml-unbounded-prisms is not supported on this device")}):V(a)},V=(a)=>{if(a._model||a._quad)n(a,!0),a._model?I(a):a._quad&&J(a)},K=(a)=>{void 0===a._mutationObserver&&(a._mutationObserver=new MutationObserver((b)=>{b.forEach((b)=>
{k(a)||"hidden"===a.visibility?k(a)&&"hidden"===a.visibility?a.visibility="visible":!k(a)||"hidden"===a.visibility||a._volume||a.scrollable||a.callRender():a.visibility="hidden";var c;if(c="hidden"!==a.visibility&&a._transform){c=b.target;var {positionX:e,positionY:f}=G(c);c=Math.fround(e)!==Math.fround(c._volume.position.positionX)||Math.fround(f)!==Math.fround(c._volume.position.positionY)?!0:!1}c&&Q(b.target)})}),a._mutationObserver.observe(a,{attributeOldValue:!0,attributes:!0,attributeFilter:["style",
"class"]}))},L=(a)=>{if(a._model||a._quad)!a.scrollable&&v(a)?navigator.permissions.request({name:"ml-unbounded-prisms"}).then((b)=>{"granted"==b.state?W(a):"denied"==b.state&&console.error("Permission to render unbounded volume has not been granted")}).catch((b)=>{w(a,"Requesting ml-unbounded-prisms is not supported on this device")}):W(a)},W=(a)=>{if(a._model||a._quad){if(a._volume){let {width:b,height:c,breadth:d}=p(a);0===b||0===c||0===d?console.error(`At least one of the dimension was not specified. Dimensions are specified using CSS width/height properties. ${a.id}`):
a._volume.setSize(1.001*b,1.001*c,1.001*d)}n(a,!0);a._model?I(a):a._quad&&J(a)}},M=(a)=>{void 0===a._resizeObserver&&(a._resizeObserver=new ResizeObserver((b)=>{b.forEach((b)=>{var c;if(c=a._model||a._quad){c=b.target;var {width:e,height:f}=p(c);c=Math.fround(e)!==Math.fround(c._volume.width/1.001)||Math.fround(f)!==Math.fround(c._volume.height/1.001)?!0:!1}c&&L(b.target)})}),a._resizeObserver.observe(a))},Ea=(a)=>{"none"===a.style.display||0!==a.clientWidth&&0!==a.clientHeight||(a._mutationObserver&&
(a._mutationObserver.disconnect(),delete a._mutationObserver),a._resizeObserver&&(a._resizeObserver.disconnect(),delete a._resizeObserver),0===a.clientWidth&&(a.style.width=0<a.clientHeight?`${a.clientHeight}px`:"inherit",0===a.clientWidth&&(a.style.width="auto"),0===a.clientWidth&&(a.style.width=`${a.parentElement.clientWidth}px`)),0===a.clientHeight&&(a.style.height="inherit",0===a.clientHeight&&(a.style.height="auto"),0===a.clientHeight&&0<a.clientWidth&&(a.style.height=`${a.clientWidth}px`)),
K(a),M(a))},X=(a)=>{if(a._volume)throw Error("Volume already exists");0!==a.clientWidth&&0!==a.clientHeight||Ea(a);let {width:b,height:c,breadth:d}=p(a);if(0===b||0===c||0===d)throw Error("At least one of the volume's dimension is not specified.  Dimensions are specified using CSS width/height properties");let e=window.mlWorld.createVolume(1.001*b,1.001*c,1.001*d);if(!e)throw Error("Volume was not created");e.addEventListener("mlraycast",(b)=>{if(a._volume.visible){let c=b.type.replace(/Totem/g,"Control"),
d="";0<=c.search(/control/i)?d="control":0<=c.search(/head/i)&&(d="headpos");if("volume"===b.hitData.type)b=new CustomEvent("volume-raycast",{detail:{inputType:d,type:c,hitData:b.hitData}}),a.dispatchEvent(b);else if("quadNode"===b.hitData.type||"modelNode"===b.hitData.type)b=new CustomEvent("node-raycast",{detail:{inputType:d,type:c,hitData:b.hitData}}),a.dispatchEvent(b)}});return e},Fa=(a,b)=>(new RegExp(/\.(fbx|glb)(\?|#|$)/i)).test(b)?fetch(b).then((c)=>c.ok?c.arrayBuffer().then((c)=>{let d=
a._volume,f;if(b.match(/\.glb(\?|#|$)/i)&&"glTF"===String.fromCharCode.apply(null,new Uint8Array(c,0,4)))f="Pbr";else if(b.match(/\.fbx(\?|#|$)/i)&&"Kaydara FBX Binary  \x00\u001a\x00"===String.fromCharCode.apply(null,new Uint8Array(c,0,23)))f="UnlitTextured";else return Promise.reject(Error(`Invalid model file: ${b}. Only FBX and GLB are supported at the moment.`));return(c=d.createModelResource(c))?{resource:c,shader:f}:Promise.reject(Error(`Load resource failed: ${b}`))}):Promise.reject(Error(`Load resource failed: ${b}`))):
Promise.reject(Error(`Invalid model file extension: ${b}. Only FBX and GLB are supported at the moment.`)),y=(a,b=!0)=>{a.skipRaycast=b},Y=(a,b=!1)=>{a._volume&&((a._volume.visible=b)?"hidden"===a.style.visibility&&(a.style.visibility="visible"):b||"none"===a.style.display||(a.style.visibility="hidden"))},Z=(a,b)=>{document.getElementById(b)&&document.getElementById(b).addEventListener("click",()=>{document.querySelectorAll("ml-model[trigger], ml-quad[trigger]").forEach(function(a){a.visibility="hidden"});
a.visibility="show"})},aa=(a,b)=>{b&&a._transform&&(b=b.trim().replace(/[^\d.-]+/g," ").split(" ").map(parseFloat).filter((a)=>!isNaN(a)),a._transform.setLocalScale(new Float32Array(b)),a.isInsideVolume()||console.warn(`Content is clipping or is rendering outside of prism. ${a.id}`))},ba=(a,b)=>{b&&(b=b.trim().replace(/  +/g," ").split(" ").map(h),a._transform.setLocalPosition(new Float32Array(b)),a.isInsideVolume()||console.warn(`Content is clipping or is rendering outside of prism. ${a.id}`))},
ca=(a,b)=>{if(b){var c=H(b);b=Math.cos(c[0]/2);var d=Math.cos(c[1]/2),e=Math.cos(c[2]/2),f=Math.sin(c[0]/2),g=Math.sin(c[1]/2);c=Math.sin(c[2]/2);(b=[f*d*e-b*g*c,b*g*e+f*d*c,b*d*c-f*g*e,b*d*e+f*g*c],a._transform)&&a._transform.setLocalRotation(new Float32Array(b))}},da=(a,b)=>{if(b&&(b=H(b))){let c=(new DOMMatrix).translate(a._volume.position.positionX,a._volume.position.positionY,a._volume.position.positionZ);c=c.rotateAxisAngle(0,0,1,180/Math.PI*b[2]).rotateAxisAngle(0,1,0,180/Math.PI*b[1]).rotateAxisAngle(1,
0,0,180/Math.PI*b[0]);a._volume.transformVolumeRelativeToHostVolume(c)}},Ga=(a)=>{var b={},c=["name","paused","iterations"];a.split(/;|,/).forEach((a,e)=>{a=a.split(":");2===a.length?b[a[0].trim()]=a[1].trim():1===a.length&&(b[c[e]]=a[0].trim())});if(b.name)return b.paused?b.paused="false"===b.paused||"no"===b.paused||"0"===b.paused||""===b.paused?!1:!0:(b.paused=!1,console.warn("Invalid paused value for animation attribute. Default value of false used.")),isNaN(parseInt(b.iterations))?(b.iterations=
-1,console.warn("Invalid iterations value for model-animation attribute. Default value of -1 used.")):b.iterations=parseInt(b.iterations),b;console.error("No animation name found in animation attribute.")},Ha=(a,b,c)=>{b&&(b=Ga(b))&&a._model&&(a._model.playAnimation(b.name,b.paused,b.iterations),isNaN(parseInt(c))||(a._model.animationPlaybackSpeed=Number(c)),a._volume.addEventListener("mlanimation",(b)=>{"animationEnd"===b.type&&(b=new CustomEvent("model-animation-end",{detail:{animationName:b.animationName}}),
a.dispatchEvent(b))}))},r=(a,b=!1)=>{var c={};a.toLowerCase().split(/;/).forEach((a)=>{var d=a.split(":");if(2===d.length)if(a=d[0].trim(),d=d[1].trim(),"offset"===a)c[a]=d.replace(/\r?\n|\r|\t|,/gm," ").replace(/  +/g," ").split(" ");else{var f=d.match(/[+-]?\d+(\.\d+)?/g);f&&(c[a]=f.map((a)=>parseFloat(a)));c[a]&&(1===c[a].length?(c[a]=c[a][0],!b||"angle"!==a&&"rate"!==a||isNaN(d)&&!isNaN(parseFloat(d))&&-1!==d.indexOf("deg")&&(c[a]=parseFloat(d)*(Math.PI/180))):"angles"===a&&(f=c[a].reduce((a,
b)=>a+(0===b),0),d.split("deg").length-1>=3-f&&(c[a]=c[a].map((a)=>Math.PI/180*a))))}});if(c.axes&&3===c.axes.length||c.angles&&3===c.angles.length||c.offset&&3===c.offset.length)return isNaN(c.duration)&&(c.duration=60,console.warn("No duration value in animation attribute. Default value of 60 seconds used.")),Number.isInteger(c.track)||(c.track=0,console.warn("No track value in animation attribute. Default value of 0 used.")),b&&c.hasOwnProperty("rate")&&!isNaN(parseFloat(c.rate))&&(c.angle=c.rate,
delete c.rate),b&&isNaN(c.angle)&&(c.angle=1.0472,console.warn("No angle rate value in spin animation attribute. Default value of 60 degrees per second used.")),c;console.error("Invalid axes value used for animation attribute.")},ea=(a,b)=>{if(b){let c=r(b,!0);c&&(a._transform.spin(new Float32Array(c.axes),c.angle,c.duration,c.track),a._transform.addMoveCallback(c.track),a._volume.addEventListener("mltransformanimation",function(b){b.track===c.track&&(b.stopImmediatePropagation(),b=new CustomEvent("transform-animation-end",
{detail:{track:b.track,type:b.type}}),a.dispatchEvent(b))}))}},fa=(a,b)=>{if(b){let c=r(b);c&&(a._transform.scaleTo(new Float32Array(c.axes),c.duration,c.track),a._transform.addMoveCallback(c.track),a._volume.addEventListener("mltransformanimation",function(b){b.track===c.track&&(b.stopImmediatePropagation(),b=new CustomEvent("transform-animation-end",{detail:{track:b.track,type:b.type}}),a.dispatchEvent(b))}),a.isInsideVolume(a._transform.getLocalPosition(),c.axes)||console.warn(`Content is clipping or is rendering outside of prism. ${a.id}`))}},
Ia=(a,b)=>{switch(b[0]){case "left":var c=0;break;case "middle":case "center":c=window.outerWidth/2;break;case "right":c=window.outerWidth;break;default:c=isNaN(parseFloat(b[0]))?void 0:parseFloat(b[0])}switch(b[1]){case "top":var d=0;break;case "middle":case "center":d=window.outerHeight/2;break;case "bottom":d=window.outerHeight;break;default:d=isNaN(parseFloat(b[1]))?void 0:parseFloat(b[1])}b=isNaN(parseFloat(b[2]))?void 0:parseFloat(b[2]);b=[c,d,b];c=isNaN(parseFloat(b[0]))?a._transform.getLocalPosition()[0]:
S(b[0])-a._volume.position.positionX;d=isNaN(parseFloat(b[1]))?a._transform.getLocalPosition()[1]:T(b[1])-a._volume.position.positionY;a=isNaN(parseFloat(b[2]))?a._transform.getLocalPosition()[2]:U(b[2])-a._volume.position.positionZ;return[c,d,a]},ha=(a,b)=>{if(b){let d=r(b);if(d){var c;d.offset?c=Ia(a,d.offset):d.axes&&(c=d.axes.map(h));a._transform.moveTo(new Float32Array(c),d.duration,d.track);a._transform.addMoveCallback(d.track);a._volume.addEventListener("mltransformanimation",function(b){b.track===
d.track&&(b.stopImmediatePropagation(),b=new CustomEvent("transform-animation-end",{detail:{track:b.track,type:b.type}}),a.dispatchEvent(b))});a.isInsideVolume(c)||console.warn(`Content is clipping or is rendering outside of prism. ${a.id}`)}}},ia=(a,b)=>{if(b){let c=r(b);if(c&&c.axes){b=c.axes.map(h);let d=a._transform.getLocalPosition(),e=b.map((a,b)=>a+d[b]);a._transform.moveBy(new Float32Array(b),c.duration,c.track);a._transform.addMoveCallback(c.track);a._volume.addEventListener("mltransformanimation",
function(b){b.track===c.track&&(b.stopImmediatePropagation(),b=new CustomEvent("transform-animation-end",{detail:{track:b.track,type:b.type}}),a.dispatchEvent(b))});a.isInsideVolume(e)||console.warn(`Content is clipping or is rendering outside of prism. ${a.id}`)}else console.error(`Invalid axis values used for animation attribute. ${a.id}`)}},ja=(a,b)=>{if(b){let c=r(b);c&&(a._transform.rotateToAngles(new Float32Array(c.angles),c.duration,c.track),a._transform.addMoveCallback(c.track),a._volume.addEventListener("mltransformanimation",
function(b){b.track===c.track&&(b.stopImmediatePropagation(),b=new CustomEvent("transform-animation-end",{detail:{track:b.track,type:b.type}}),a.dispatchEvent(b))}))}},ka=(a,b)=>{if(b){let c=r(b);c&&(a._transform.rotateByAngles(new Float32Array(c.angles),c.duration,c.track),a._transform.addMoveCallback(c.track),a._volume.addEventListener("mltransformanimation",function(b){b.track===c.track&&(b.stopImmediatePropagation(),b=new CustomEvent("transform-animation-end",{detail:{track:b.track,type:b.type}}),
a.dispatchEvent(b))}))}},A=(a)=>{a&&a.addEventListener("mousedown",N,!1)},N=(a)=>{if(6===a.button){a.stopImmediatePropagation();a=a.target;var b=a._model?a._model:a._quad;if(a._volume&&a._volume.visible&&b){a._originalScale&&a._transform.setLocalScale(new Float32Array([a._originalScale[0],a._originalScale[1],a._originalScale[2]]));a._originalPosition&&a._transform.setLocalPosition(new Float32Array([a._originalPosition[0],a._originalPosition[1],a._originalPosition[2]]));window.mlWorld.update();a._originalVolumeSize&&
a._volume.setSize(a._originalVolumeSize[0],a._originalVolumeSize[1],a._originalVolumeSize[2]);let [g,h,z]=b.getLocalScale();let l,u;if(a._model&&a._resource){var c=a._resource.width*g;l=a._resource.height*h;u=a._resource.depth*z}else a._quad&&(c=g,l=h,u=z);b=[a._volume.width,a._volume.height,a._volume.breadth];let q=a._transform.getLocalScale(),k=a._transform.getLocalPosition();if(a.extractedSize){var [d,e,f]=a.extractedSize.replace(/  +/g," ").split(" ").map(parseFloat);isNaN(f)&&(f=a._quad?0:d);
if(isNaN(d)||isNaN(e)||isNaN(f))console.warn("Invalid values used for extracted-size attribute.");else{let b=d/c,g=e/l,h=f/u,k=Math.min(c*q[0]/d,l*q[1]/e);1>k&&(b*=k,g*=k,h*=k,a.extractedScale=1/k);a._transform.setLocalScale(new Float32Array([b,g,h]));a._volume.setSize(c*b*1.001,l*g*1.001,u*h*1.001)}}a._transform.setLocalPosition(new Float32Array([0,0,0]));c=new Event("extracting-node");a.dispatchEvent(c);Ja(a);a.addEventListener("click",(a)=>a.stopImmediatePropagation(),{once:!0});a._transform.setLocalScale(new Float32Array([q[0],
q[1],q[2]]));a._transform.setLocalPosition(new Float32Array([k[0],k[1],k[2]]));a._volume.setSize(b[0],b[1],b[2])}}},Ja=(a)=>{var b=a._volume.position,c=a.extractedScale?a.extractedScale:1;let d=b.positionZ+a._volume.breadth;b=(new DOMMatrix).translate(b.positionX,b.positionY,d);a._volume.extractContent({scale:c,transform:b,doIt:"auto",origin_url:a.extractedLink?a.extractedLink:window.location.href});c=new Event("node-extracted");a.dispatchEvent(c)},B=(a)=>{a.style.cursor="-webkit-grab";a.addEventListener("mouseover",
la);a.addEventListener("mouseout",ma);a.addEventListener("mousemove",O)},na=(a)=>{a.style.cursor="auto";a.removeEventListener("mouseover",la);a.removeEventListener("mouseout",ma);a.removeEventListener("mousemove",O)},la=(a)=>{a=a.target;a._volume&&a._volume.visible&&a._transform&&(a.removeEventListener("mousemove",O),"function"===typeof a._volume.triggerTotemHaptic?a._volume.triggerTotemHaptic("VIBE_TICK"):"function"===typeof a._volume.triggerControlHaptic&&a._volume.triggerControlHaptic("VIBE_TICK"),
a._mouseOutTimeout&&(clearTimeout(a._mouseOutTimeout),a._mouseOutTimeout=null),a._originalVolumeSize||(a._originalVolumeSize=[a._volume.width,a._volume.height,a._volume.breadth]),a._volume.setSize(1.25*a._originalVolumeSize[0],1.25*a._originalVolumeSize[1],1.25*a._originalVolumeSize[2]+.04),a._originalScale||(a._originalScale=a._transform.getLocalScale()),a._transform.scaleTo(new Float32Array([1.25*a._originalScale[0],1.25*a._originalScale[1],1.25*a._originalScale[2]]),.1,-1),a._originalPosition||
(a._originalPosition=a._transform.getLocalPosition()),a._transform.moveTo(new Float32Array([a._originalPosition[0],a._originalPosition[1],a._originalPosition[2]+.02]),.1,-2))},O=(a)=>{a=a.target;let b=document.createEvent("MouseEvent");b.initEvent("mouseover",!0,!0);a.dispatchEvent(b)},ma=(a)=>{let b=a.target;b._volume&&b._transform&&("function"===typeof b._volume.triggerTotemHaptic?b._volume.triggerTotemHaptic("VIBE_FORCE_DWELL"):"function"===typeof b._volume.triggerControlHaptic&&b._volume.triggerControlHaptic("VIBE_FORCE_DWELL"),
b._originalPosition&&b._transform.moveTo(new Float32Array([b._originalPosition[0],b._originalPosition[1],b._originalPosition[2]]),.1,-1),b._originalScale&&b._transform.scaleTo(new Float32Array([b._originalScale[0],b._originalScale[1],b._originalScale[2]]),.1,-2),b._mouseOutTimeout&&clearTimeout(b._mouseOutTimeout),b._mouseOutTimeout=window.setTimeout(()=>{b._originalVolumeSize&&b._volume&&(window.mlWorld.update(),b._volume.setSize(b._originalVolumeSize[0],b._originalVolumeSize[1],b._originalVolumeSize[2]))},
200))},C=(a)=>{void 0===a._scrollListener&&(a._scrollListener=t.bind(a),window.addEventListener("scroll",a._scrollListener))},D=(a)=>{a._scrollListener&&(window.removeEventListener("scroll",a._scrollListener),delete a._scrollListener)},E=(a)=>{a._volume&&(window.mlWorld.deleteVolume(a._volume),a._volume=void 0,a._model=void 0,a._quad=void 0,a._transform=void 0,a._resource=void 0)},F=(a)=>{void 0===a._observer&&(a._observer=new IntersectionObserver(Ka,{root:null,rootMargin:"0px",threshold:[0,.1,.2,
.3,.4,.5,.6,.7,.8,.9,1]}));a._observer.observe(a);a._lastIntersectionRatio=0},Ka=(a,b)=>{a.forEach((a)=>{let b=a.target;.5<=a.intersectionRatio&&!b._volume&&b.src?b.doRendering().then(()=>{b._delete?(E(b),b._delete=!1):(b._rendered=!0,b.scaleScroll&&oa(b,b._lastIntersectionRatio),"hidden"===b.visibility||k(b))?"hidden"!==b.visibility&&(b._volume.visible=!0):b.visibility="hidden"}).catch((a)=>{b.dispatchEvent(new ErrorEvent("error",{error:a,message:a.message||"Problem rendering node",bubbles:!0}));
console.error(`Problem rendering: ${a}`)}):.5>a.intersectionRatio&&b._volume&&b.scrollable&&(!0===b._rendered?(E(b),delete b._rendered):b._delete=!0);b.scaleScroll&&oa(b,a.intersectionRatio);b._lastIntersectionRatio=a.intersectionRatio})},oa=(a,b)=>{a.scrollable&&a.scaleScroll&&a._transform&&(a._originalScale||(a._originalScale=a._transform.getLocalScale()),1>b&&.5<=b?(b=Math.abs(1-b/.5),a._transform.scaleTo(new Float32Array([a._originalScale[0]*b,a._originalScale[1]*b,a._originalScale[2]*b]),0,-1)):
.5>=b?a._transform.setLocalScale(new Float32Array([0,0,0])):1===b&&a._transform.scaleTo(new Float32Array([a._originalScale[0],a._originalScale[1],a._originalScale[2]]),0,-1))},La=(a)=>{var b={};a.split(/;/).forEach((a)=>{a=a.split(":");2===a.length&&(b[a[0].trim()]=a[1].trim())});if(b["color-intensity"]||b["bloom-strength"])return b;console.error("Invalid values used for environment lighting attribute. Make sure to specify color-intensity or bloom-strength.")},pa=(a,b)=>{var c=a._model;let d=a._volume;
b.src&&a._volume&&a.render();b.extractable&&("false"!==b.extractable?(B(a),A(a)):(na(a),a&&a.removeEventListener("mousedown",N,!1)));b.scrollable&&("false"!==b.scrollable?(C(a),F(a)):(D(a),a._observer&&(a._observer.unobserve(a),delete a._observer)));if(c){b.color?c.color=b.color:""===b.color&&(c.color="#FFFFFF");if(b["environment-lighting"]){let a=La(b["environment-lighting"]);a["color-intensity"]&&(c.colorIntensity=a["color-intensity"]);a["bloom-strength"]&&(c.bloomStrength=a["bloom-strength"],d.bloomStrength=
a["bloom-strength"])}b.raycast&&y(c,"true"!=b.raycast);b.visibility&&Y(a,"hidden"!==b.visibility);b.trigger&&Z(a,b.trigger);b["model-scale"]&&(aa(a,b["model-scale"]),l(a));b["model-position"]&&(ba(a,b["model-position"]),l(a));b.rotation&&ca(a,b.rotation);b["prism-rotation"]&&da(a,b["prism-rotation"]);b["model-animation"]&&Ha(a,b["model-animation"],a.animationSpeed);b["model-animation-speed"]&&(c=b["model-animation-speed"],!isNaN(parseInt(c))&&a._model&&(a._model.animationPlaybackSpeed=Number(c)));
b.spin&&ea(a,b.spin);b["scale-to"]&&(fa(a,b["scale-to"]),l(a));b["move-to"]&&(ha(a,b["move-to"]),l(a));b["move-by"]&&(ia(a,b["move-by"]),l(a));b["rotate-to-angles"]&&ja(a,b["rotate-to-angles"]);b["rotate-by-angles"]&&ka(a,b["rotate-by-angles"]);(b.breadth||b["z-offset"])&&L(a)}},P=(a)=>new Promise((b,c)=>{Fa(a,a.getAttribute("src")).then((d)=>{a._model||(a._model=a._volume.createModel(),"true"!==a.raycast&&y(a._model));a._model.triggerable=!0;a._resource=d.resource;a._model.setModelResource(a._resource);
if(isNaN(parseFloat(a._resource.width))||!isFinite(a._resource.width))return c(Error(`Load resource failed: ${a.src}`));var e=new Event("resource-loaded");a.dispatchEvent(e);a._kmat||(a._model.shader=d.shader);a._transform||(a._transform=a._volume.createTransform(),a._transform.addChild(a._model),a._volume.addChild(a._transform));a._kmat&&a._textures&&(a._model.textures=a._textures,a._model.kmat=a._kmat);n(a);I(a);d={visibility:a.getAttribute("visibility"),trigger:a.getAttribute("trigger"),color:a.getAttribute("color"),
"model-scale":a.getAttribute("model-scale"),"model-position":a.getAttribute("model-position"),rotation:a.getAttribute("rotation"),"rotate-to-angles":a.getAttribute("rotate-to-angles"),"rotate-by-angles":a.getAttribute("rotate-by-angles"),"model-animation":a.getAttribute("model-animation"),spin:a.getAttribute("spin"),"scale-to":a.getAttribute("scale-to"),"move-to":a.getAttribute("move-to"),"move-by":a.getAttribute("move-by"),"prism-rotation":a.getAttribute("prism-rotation"),"environment-lighting":a.getAttribute("environment-lighting")};
pa(a,d);window.mlWorld.update();e=new Event("model-displayed");a.dispatchEvent(e);b(a._model)}).catch((a)=>{c(a)})}),Ma=(a)=>new Promise((b,c)=>{if(!a._volume)try{a._volume=X(a)}catch(e){return c(e)}a._volume.visible=!1;if(a.hasAttribute("materials"))var d=Ba(a.getAttribute("materials"));if(d)Ca(a._volume,d.textures).then((e)=>{a._textures=e;Da(a._volume,d.kmat).then((d)=>{a._kmat=d;d=new Event("mesh-readytoload");a.dispatchEvent(d);a.async?b(a._volume):P(a).then(()=>{b(a._volume)}).catch((a)=>{c(Error(`Problem creating model: ${a}`))})}).catch((a)=>
{c(Error(`Problem creating Kmat: ${a}`))})}).catch((a)=>{c(Error(`Problem creating texture: ${a}`))});else{let d=new Event("mesh-readytoload");a.dispatchEvent(d);a.async?b(a._volume):P(a).then(()=>{b(a._volume)}).catch((a)=>{c(Error(`Problem creating model: ${a}`))})}}),qa=(a)=>{void 0===a._resizeListener&&(a._resizeListener=Aa.bind(a),window.addEventListener("resize",a._resizeListener))},ra=(a)=>{a._resizeListener&&(window.removeEventListener("resize",a._resizeListener),delete a._resizeListener)},
sa=(a,b=.1)=>{let c=a._model?a._model:a._quad;if(c){var d=1,e=1,f=c.backfaceVisibility;c.backfaceVisibility=!1;"#"==c.color.charAt(0)&&7===c.color.length&&(c.color+="FE");if(a._volume.visible&&"#"!==c.color.charAt(0)){let g=c.color.match(/[+-]?\d+(\.\d+)?/g);0<parseFloat(g[3])&&(d=e=parseFloat(g[3]));(function z(){d-=b;0>parseFloat(d)?(a.visibility="hidden",g[3]=e,c.color=`rgba(${g.join(", ")})`,"undefined"!==typeof c.isOpaque&&(c.isOpaque=!0),c.backfaceVisibility=f):(g[3]=d,c.color=`rgba(${g.join(", ")})`,
setTimeout(z,16))})()}}},ta=(a,b=.1)=>{let c=a._model?a._model:a._quad;if(c){var d=0,e=1,f=c.backfaceVisibility;c.backfaceVisibility=!1;"#"==c.color.charAt(0)&&7===c.color.length&&(c.color+="00");if("#"!==c.color.charAt(0)){let g=c.color.match(/[+-]?\d+(\.\d+)?/g);0<parseFloat(g[3])&&(e=parseFloat(g[3]));g[3]=0;c.color=`rgba(${g.join(", ")})`;a.visibility="visible";(function z(){d+=b;parseFloat(d)>e?(g[3]=e,c.color=`rgba(${g.join(", ")})`,"undefined"!==typeof c.isOpaque&&1<=e&&(c.isOpaque=!0),c.backfaceVisibility=
f):(g[3]=d,c.color=`rgba(${g.join(", ")})`,setTimeout(z,16))})()}}},ua=(a,b=[0,1,0])=>{a._transform&&(a._transform.rotateBy(new Float32Array(b),.07,.1,0),a._transform.rotateBy(new Float32Array(b),-.07,.1,0),a._transform.rotateBy(new Float32Array(b),-.07,.1,0),a._transform.rotateBy(new Float32Array(b),.07,.1,0))};class va extends HTMLElement{constructor(){super();this.addEventListener("error",function(a){!this._model&&this.hasAttribute("alt-img")&&(this.style.setProperty("background-image","url("+
this.getAttribute("alt-img")+")"),this.style.setProperty("background-repeat","no-repeat"),this.style.setProperty("background-size","100%"))},!0)}connectedCallback(){window.mlWorld?(this.style.display||(this.style.display="inline-flex"),this.extractable&&(B(this),A(this)),K(this),M(this),qa(this),this.scrollable?(C(this),F(this)):k(this)&&this.callRender()):this.dispatchEvent(new ErrorEvent("error",{error:Error("Unable to render 3D content on this device."),message:"No mixed-reality browser detected.",
bubbles:!0}))}callRender(){v(this)?navigator.permissions.request({name:"ml-unbounded-prisms"}).then((a)=>{"granted"==a.state?this.render():"denied"==a.state&&console.error("Permission to render unbounded volume has not been granted")}).catch((a)=>{w(this,"Requesting ml-unbounded-prisms is not supported on this device")}):this.render()}render(){this.src&&this.doRendering().then(()=>{this._volume.visible="hidden"!==this.visibility}).catch((a)=>{this.dispatchEvent(new ErrorEvent("error",{error:a,message:a.message||
"Problem rendering node",bubbles:!0}));console.error(`Problem rendering: ${a}`)})}doRendering(){return Ma(this)}static get observedAttributes(){return"async extractable scrollable scale-scroll breadth materials color visibility raycast rotation rotate-to-angles rotate-by-angles prism-rotation model-animation model-animation-speed spin model-position model-scale scale-to extracted-scale extracted-size extracted-link move-to move-by src z-offset environment-lighting".split(" ")}attributeChangedCallback(a,
b,c){this._volume&&pa(this,{[a]:c})}disconnectedCallback(){E(this);D(this);ra(this)}get async(){return this.hasAttribute("async")&&(""===this.getAttribute("async")||"true"===this.getAttribute("async"))}set async(a){this.getAttribute("async")!==a.toString()&&this.setAttribute("async",a.toString())}get extractable(){return this.hasAttribute("extractable")&&(""===this.getAttribute("extractable")||"true"===this.getAttribute("extractable"))}set extractable(a){this.getAttribute("extractable")!==a.toString()&&
this.setAttribute("extractable",a.toString())}get scrollable(){return this.hasAttribute("scrollable")&&(""===this.getAttribute("scrollable")||"true"===this.getAttribute("scrollable"))}set scrollable(a){this.getAttribute("scrollable")!==a.toString()&&this.setAttribute("scrollable",a.toString())}get scaleScroll(){return this.hasAttribute("scale-scroll")&&(""===this.getAttribute("scale-scroll")||"true"===this.getAttribute("scale-scroll"))}set scaleScroll(a){this.getAttribute("scale-scroll")!==a.toString()&&
this.setAttribute("scale-scroll",a.toString())}get breadth(){return x(this.getAttribute("breadth"))}set breadth(a){this.getAttribute("breadth")!==a.toString()&&(isNaN(parseFloat(a))||this.setAttribute("breadth",a.toString()))}get materials(){return this.getAttribute("materials")}set materials(a){this.getAttribute("materials")!==a.toString()&&this.setAttribute("materials",a)}get color(){return this.getAttribute("color")}set color(a){this.getAttribute("color")!==a.toString()&&this.setAttribute("color",
a)}get visibility(){return this.getAttribute("visibility")}set visibility(a){this.getAttribute("visibility")!==a.toString()&&this.setAttribute("visibility",a)}get raycast(){return this.getAttribute("raycast")}set raycast(a){this.getAttribute("raycast")!==a.toString()&&this.setAttribute("raycast",a.toString())}get rotation(){return this.getAttribute("rotation")}set rotation(a){this.setAttribute("rotation",a)}get rotateToAngles(){return this.getAttribute("rotate-to-angles")}set rotateToAngles(a){this.setAttribute("rotate-to-angles",
a)}get rotateByAngles(){return this.getAttribute("rotate-by-angles")}set rotateByAngles(a){this.setAttribute("rotate-by-angles",a)}get prismRotation(){return this.getAttribute("prism-rotation")}set prismRotation(a){this.getAttribute("prism-rotation")!==a.toString()&&this.setAttribute("prism-rotation",a)}get animation(){return this.getAttribute("model-animation")}set animation(a){this.setAttribute("model-animation",a)}get animationSpeed(){return parseFloat(this.getAttribute("model-animation-speed"))}set animationSpeed(a){this.getAttribute("model-animation-speed")!==
a.toString()&&(isNaN(parseFloat(a))||this.setAttribute("model-animation-speed",parseFloat(a)))}get spin(){return this.getAttribute("spin")}set spin(a){this.setAttribute("spin",a)}get modelPosition(){return this.getAttribute("model-position")}set modelPosition(a){this.setAttribute("model-position",a)}get modelScale(){return this.getAttribute("model-scale")}set modelScale(a){this.setAttribute("model-scale",a)}get scaleTo(){return this.getAttribute("scale-to")}set scaleTo(a){this.setAttribute("scale-to",
a)}get extractedScale(){return parseFloat(this.getAttribute("extracted-scale"))}set extractedScale(a){this.getAttribute("extracted-scale")!==a.toString()&&(isNaN(parseFloat(a))||this.setAttribute("extracted-scale",parseFloat(a)))}get extractedSize(){return this.getAttribute("extracted-size")}set extractedSize(a){this.getAttribute("extracted-size")!==a.toString()&&this.setAttribute("extracted-size",a)}get extractedLink(){return this.getAttribute("extracted-link")}set extractedLink(a){this.getAttribute("extracted-link")!==
a.toString()&&this.setAttribute("extracted-link",a)}get moveTo(){return this.getAttribute("move-to")}set moveTo(a){this.setAttribute("move-to",a)}get moveBy(){return this.getAttribute("move-by")}set moveBy(a){this.setAttribute("move-by",a)}get src(){return this.getAttribute("src")}set src(a){this.getAttribute("src")!==a.toString()&&this.setAttribute("src",a)}get zOffset(){return this.hasAttribute("z-offset")&&!isNaN(parseFloat(this.getAttribute("z-offset")))?x(this.getAttribute("z-offset")):150}set zOffset(a){this.getAttribute("z-offset")!==
a.toString()&&(isNaN(parseFloat(a))||this.setAttribute("z-offset",a.toString()))}get environmentLighting(){return this.getAttribute("environment-lighting")}set environmentLighting(a){this.setAttribute("environment-lighting",a)}createNode(){return P(this)}isInsideVolume(a=this._transform.getLocalPosition(),b=this._transform.getLocalScale()){let c=Math.fround(this._volume.position.positionX-this._volume.width/2),d=Math.fround(this._volume.position.positionX+this._volume.width/2),e=Math.fround(this._volume.position.positionY-
this._volume.height/2),f=Math.fround(this._volume.position.positionY+this._volume.height/2),g=Math.fround(this._volume.position.positionZ-this._volume.breadth/2),h=Math.fround(this._volume.position.positionZ+this._volume.breadth/2),[k,l,u]=a,[q,m,n]=this._model.getLocalScale(),[p,r,t]=b;a=Math.fround(this._volume.position.positionX+k-Math.fround(this._resource.width*q*p/2));b=Math.fround(this._volume.position.positionX+k+Math.fround(this._resource.width*q*p/2));let v=Math.fround(this._volume.position.positionY+
l-Math.fround(this._resource.height*m*r/2)),w=Math.fround(this._volume.position.positionY+l+Math.fround(this._resource.height*m*r/2)),x=Math.fround(this._volume.position.positionZ+u-Math.fround(this._resource.depth*n*t/2)),y=Math.fround(this._volume.position.positionZ+u+Math.fround(this._resource.depth*n*t/2));return c<=a&&b<=d&&e<=v&&w<=f&&g<=x&&y<=h}fadeOut(a){sa(this,a)}fadeIn(a){ta(this,a)}wiggle(a){ua(this,a)}}window.customElements.define("ml-model",va);let Na=(a,b)=>(new RegExp(/(\.(jpg|jpeg|png)(\?|#|$))|^(data:image\/(jpg|jpeg|png);base64,*)/i)).test(b)?
new Promise((c,d)=>{var e=new Image;e.onload=()=>{let f=a.createTexture(e);f?c(f):d(Error(`Problem loading quad texture: ${b}.`))};e.onerror=()=>{d(Error(`Problem loading quad texture: ${b}.`))};e.src=b}):Promise.reject(Error(`Invalid quad image file type: ${b}. Only JPG and PNG are supported at the moment for quads.`)),wa=(a,b)=>{let c=a._quad;b.src&&a._volume&&a.render();b.extractable&&("false"!==b.extractable?(B(a),A(a)):(na(a),a&&a.removeEventListener("mousedown",N,!1)));b.scrollable&&("false"!==
b.scrollable?(C(a),F(a)):(D(a),a._observer&&(a._observer.unobserve(a),delete a._observer)));c&&(b.color?c.color=b.color:""===b.color&&((new RegExp(/(\.png(\?|#|$))|^(data:image\/png;base64,*)/i)).test(a.src)?c.color="rgba(255, 255, 255, 0.99)":c.color="#FFFFFF"),b.raycast&&y(c,"true"!=b.raycast),b.visibility&&Y(a,"hidden"!==b.visibility),b.trigger&&Z(a,b.trigger),b["quad-scale"]&&(aa(a,b["quad-scale"]),l(a)),b.rotation&&ca(a,b.rotation),b["prism-rotation"]&&da(a,b["prism-rotation"]),b.spin&&ea(a,
b.spin),b["scale-to"]&&(fa(a,b["scale-to"]),l(a)),b["quad-position"]&&(ba(a,b["quad-position"]),l(a)),b["move-to"]&&(ha(a,b["move-to"]),l(a)),b["move-by"]&&(ia(a,b["move-by"]),l(a)),b["rotate-to-angles"]&&ja(a,b["rotate-to-angles"]),b["rotate-by-angles"]&&ka(a,b["rotate-by-angles"]),(b.breadth||b["z-offset"])&&L(a))},xa=(a)=>new Promise((b,c)=>{a._quad||(a._quad=a._volume.createQuad(),"true"!==a.raycast&&y(a._quad),a.hasAttribute("visibility")||k(a)||(a.visibility="hidden"));a._quad.setRenderResource(a._texture);
a._texture&&(a._quad.textures=a._texture);(new RegExp(/(\.png(\?|#|$))|^(data:image\/png;base64,*)/i)).test(a.src)&&(a._quad.color="rgba(255, 255, 255, 0.99)");c=new Event("resource-loaded");a.dispatchEvent(c);a._transform||(a._transform=a._volume.createTransform(),a._transform.addChild(a._quad),a._volume.addChild(a._transform));n(a);J(a);c={visibility:a.getAttribute("visibility"),trigger:a.getAttribute("trigger"),color:a.getAttribute("color"),"quad-scale":a.getAttribute("quad-scale"),"quad-position":a.getAttribute("quad-position"),
rotation:a.getAttribute("rotation"),"rotate-to-angles":a.getAttribute("rotate-to-angles"),"rotate-by-angles":a.getAttribute("rotate-by-angles"),spin:a.getAttribute("spin"),"scale-to":a.getAttribute("scale-to"),"move-to":a.getAttribute("move-to"),"move-by":a.getAttribute("move-by"),"prism-rotation":a.getAttribute("prism-rotation")};wa(a,c);window.mlWorld.update();c=new Event("quad-displayed");a.dispatchEvent(c);b(a._quad)}),Oa=(a)=>new Promise((b,c)=>{if(!a._volume)try{a._volume=X(a)}catch(d){return c(d)}a._volume.visible=
!1;Na(a._volume,a.getAttribute("src")).then((d)=>{a._texture=d;d=new Event("quad-readytoload");a.dispatchEvent(d);a.async?b(a._volume):xa(a).then(()=>{b(a._volume)}).catch((a)=>{c(Error(`Problem creating quad: ${a}`))})}).catch((a)=>{c(Error(`Problem creating texture: ${a}`))})});class ya extends HTMLElement{constructor(){super();this.addEventListener("error",function(a){!this._quad&&this.hasAttribute("alt-img")&&(this.style.setProperty("background-image","url("+this.getAttribute("alt-img")+")"),
this.style.setProperty("background-repeat","no-repeat"),this.style.setProperty("background-size","100%"))},!0)}connectedCallback(){window.mlWorld?(this.style.display||(this.style.display="inline-flex"),this.extractable&&(B(this),A(this)),K(this),M(this),qa(this),this.scrollable?(C(this),F(this)):k(this)&&this.callRender()):this.dispatchEvent(new ErrorEvent("error",{error:Error("Unable to render 3D content on this device."),message:"No mixed-reality browser detected.",bubbles:!0}))}callRender(){v(this)?
navigator.permissions.request({name:"ml-unbounded-prisms"}).then((a)=>{"granted"==a.state?this.render():"denied"==a.state&&console.error("Permission to render unbounded volume has not been granted")}).catch((a)=>{w(this,"Requesting ml-unbounded-prisms is not supported on this device")}):this.render()}render(){this.src&&this.doRendering().then(()=>{"hidden"===this.visibility||k(this)?"hidden"!==this.visibility&&(this._volume.visible=!0):this.visibility="hidden"}).catch((a)=>{this.dispatchEvent(new ErrorEvent("error",
{error:a,message:a.message||"Problem rendering node",bubbles:!0}));console.error(`Problem rendering: ${a}`)})}doRendering(){return Oa(this)}static get observedAttributes(){return"async extractable scrollable scale-scroll breadth color visibility raycast rotation rotate-to-angles rotate-by-angles prism-rotation spin quad-position quad-scale scale-to extracted-scale extracted-size extracted-link move-to move-by src z-offset".split(" ")}attributeChangedCallback(a,b,c){this._volume&&wa(this,{[a]:c})}detachedCallback(){E(this);
D(this);ra(this)}get async(){return this.hasAttribute("async")&&(""===this.getAttribute("async")||"true"===this.getAttribute("async"))}set async(a){this.getAttribute("async")!==a.toString()&&this.setAttribute("async",a.toString())}get extractable(){return this.hasAttribute("extractable")&&(""===this.getAttribute("extractable")||"true"===this.getAttribute("extractable"))}set extractable(a){this.getAttribute("extractable")!==a.toString()&&this.setAttribute("extractable",a.toString())}get scrollable(){return this.hasAttribute("scrollable")&&
(""===this.getAttribute("scrollable")||"true"===this.getAttribute("scrollable"))}set scrollable(a){this.getAttribute("scrollable")!==a.toString()&&this.setAttribute("scrollable",a.toString())}get scaleScroll(){return this.hasAttribute("scale-scroll")&&(""===this.getAttribute("scale-scroll")||"true"===this.getAttribute("scale-scroll"))}set scaleScroll(a){this.getAttribute("scale-scroll")!==a.toString()&&this.setAttribute("scale-scroll",a.toString())}get breadth(){return x(this.getAttribute("breadth"))}set breadth(a){this.getAttribute("breadth")!==
a.toString()&&(isNaN(parseFloat(a))||this.setAttribute("breadth",a.toString()))}get color(){return this.getAttribute("color")}set color(a){this.getAttribute("color")!==a.toString()&&this.setAttribute("color",a)}get visibility(){return this.getAttribute("visibility")}set visibility(a){this.getAttribute("visibility")!==a.toString()&&this.setAttribute("visibility",a)}get raycast(){return this.getAttribute("raycast")}set raycast(a){this.getAttribute("raycast")!==a.toString()&&this.setAttribute("raycast",
a.toString())}get rotation(){return this.getAttribute("rotation")}set rotation(a){this.setAttribute("rotation",a)}get rotateToAngles(){return this.getAttribute("rotate-to-angles")}set rotateToAngles(a){this.setAttribute("rotate-to-angles",a)}get rotateByAngles(){return this.getAttribute("rotate-by-angles")}set rotateByAngles(a){this.setAttribute("rotate-by-angles",a)}get prismRotation(){return this.getAttribute("prism-rotation")}set prismRotation(a){this.getAttribute("prism-rotation")!==a.toString()&&
this.setAttribute("prism-rotation",a)}get spin(){return this.getAttribute("spin")}set spin(a){this.setAttribute("spin",a)}get quadPosition(){return this.getAttribute("quad-position")}set quadPosition(a){this.setAttribute("quad-position",a)}get quadScale(){return this.getAttribute("quad-scale")}set quadScale(a){this.setAttribute("quad-scale",a)}get scaleTo(){return this.getAttribute("scale-to")}set scaleTo(a){this.setAttribute("scale-to",a)}get extractedScale(){return parseFloat(this.getAttribute("extracted-scale"))}set extractedScale(a){this.getAttribute("extracted-scale")!==
a.toString()&&(isNaN(parseFloat(a))||this.setAttribute("extracted-scale",parseFloat(a)))}get extractedSize(){return this.getAttribute("extracted-size")}set extractedSize(a){this.getAttribute("extracted-size")!==a.toString()&&this.setAttribute("extracted-size",a)}get extractedLink(){return this.getAttribute("extracted-link")}set extractedLink(a){this.getAttribute("extracted-link")!==a.toString()&&this.setAttribute("extracted-link",a)}get moveTo(){return this.getAttribute("move-to")}set moveTo(a){this.setAttribute("move-to",
a)}get moveBy(){return this.getAttribute("move-by")}set moveBy(a){this.setAttribute("move-by",a)}get src(){return this.getAttribute("src")}set src(a){this.getAttribute("src")!==a.toString()&&this.setAttribute("src",a)}get zOffset(){return this.hasAttribute("z-offset")&&!isNaN(parseFloat(this.getAttribute("z-offset")))?x(this.getAttribute("z-offset")):150}set zOffset(a){this.getAttribute("z-offset")!==a.toString()&&(isNaN(parseFloat(a))||this.setAttribute("z-offset",a.toString()))}createNode(){return xa(this)}isInsideVolume(a=
this._transform.getLocalPosition(),b=this._transform.getLocalScale()){let c=Math.fround(this._volume.position.positionX-this._volume.width/2),d=Math.fround(this._volume.position.positionX+this._volume.width/2),e=Math.fround(this._volume.position.positionY-this._volume.height/2),f=Math.fround(this._volume.position.positionY+this._volume.height/2),[g,h]=a,[k,l]=this._quad.getLocalScale(),[m,q]=b;a=Math.fround(this._volume.position.positionX+g-Math.fround(k*m/2));b=Math.fround(this._volume.position.positionX+
g+Math.fround(k*m/2));let n=Math.fround(this._volume.position.positionY+h-Math.fround(l*q/2)),p=Math.fround(this._volume.position.positionY+h+Math.fround(l*q/2));return c<=a&&b<=d&&e<=n&&p<=f}fadeOut(a){sa(this,a)}fadeIn(a){ta(this,a)}wiggle(a){ua(this,a)}}window.customElements.define("ml-quad",ya);let Pa=(a)=>{var b=a.split(", ");a=[];for(let c of b)b=c.trim().replace(/  +/g," ").split(" ").map(parseFloat).filter((a)=>!isNaN(a)),4===b.length&&a.push(b);return a};class za extends HTMLElement{connectedCallback(){let a=
h(this.clientWidth),b=h(this.clientHeight),c=this.breadth?h(this.breadth):h(this.clientWidth),d=window.mlWorld.createVolume(a,b,c);this._volume=d;var e=[];for(var f of Pa(this.getAttribute("points")))e.push(new DOMPoint(f[0],f[1],f[2],f[3]));f=d.createLine();f.setPoints(e);f.color=this.getAttribute("color")?this.getAttribute("color"):"#FFFFFF";f.name="firstline";e=d.createTransform();e.setLocalScale(new Float32Array([a,b,c]));e.setLocalPosition(new Float32Array([0,0,0]));e.addChild(f);d.addChild(e);
n(this)}}window.customElements.define("ml-line",za);window.mlWorld?setInterval(R,16):console.warn("Unable to render content: No mixed-reality browser detected.");m.MlModel=va;m.MlQuad=ya;m.MlLine=za;m.animate=R;Object.defineProperty(m,"__esModule",{value:!0})});
